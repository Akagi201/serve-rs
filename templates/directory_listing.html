<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index of {{ current_path }}</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Initialize theme before rendering -->
    <script>
        // Initialize theme immediately to prevent flash
        (function() {
            const storedTheme = localStorage.getItem('theme');
            const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            // Use dark theme if explicitly set to dark OR if no preference and system prefers dark
            if (storedTheme === 'dark' || (!storedTheme && systemDark)) {
                document.documentElement.classList.add('dark');
            } else {
                // Use light theme if explicitly set to light OR if no preference and system prefers light
                document.documentElement.classList.remove('dark');
            }
        })();
    </script>
    
    <style>
        /* File type icons */
        .file-icon {
            width: 20px;
            height: 20px;
            display: inline-block;
            margin-right: 8px;
        }

        /* Button styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.2s;
            text-decoration: none;
        }
        
        .btn-outline {
            border: 1px solid #d1d5db;
            background-color: transparent;
            color: #374151;
        }
        
        .btn-outline:hover {
            background-color: #f3f4f6;
        }
        
        .dark .btn-outline {
            border-color: #4b5563;
            color: #d1d5db;
        }
        
        .dark .btn-outline:hover {
            background-color: #374151;
        }

        /* Badge styles */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.125rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 dark:bg-slate-900 text-black dark:text-white">
    <div class="container mx-auto p-6 max-w-6xl">
        <!-- Header with theme toggle -->
        <header class="flex items-center justify-between mb-6 pb-4 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center space-x-4">
                <svg class="file-icon text-blue-600 dark:text-blue-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 7v10c0 2.21 1.79 4 4 4h8c2.21 0 4-1.79 4-4V7M4 7V4c0-2.21 1.79-4 4-4h8c2.21 0 4 1.79 4 4v3M4 7h16M9 11h6"/>
                </svg>
                <h1 class="text-3xl font-bold text-black dark:text-white">{{ current_path }}</h1>
            </div>
            
            <button 
                id="theme-toggle" 
                class="btn btn-outline"
                onclick="toggleTheme()"
                aria-label="Toggle theme"
            >
                <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"/>
                    <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                </svg>
                <svg id="moon-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
            </button>
        </header>

        <!-- Breadcrumb Navigation -->
        {% if parent_path.len() != 0 %}
        <nav class="mb-6">
            <div class="bg-white dark:bg-slate-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm">
                <div class="p-4">
                    <a href="{{ parent_path|urlencode }}" class="btn btn-outline inline-flex items-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="m15 18-6-6 6-6"/>
                        </svg>
                        <span>Back to Parent Directory</span>
                    </a>
                </div>
            </div>
        </nav>
        {% endif %}

        <!-- Directory Contents -->
        <div class="bg-white dark:bg-slate-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm">
            {% if entries.len() != 0 %}
            <div class="divide-y divide-gray-200 dark:divide-gray-700">
                <!-- Directories Section -->
                {% for entry in entries if entry.is_dir %}
                <div class="p-4 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                    <a href="{{ current_path|urlencode }}{% if !current_path.ends_with("/") %}/{% endif %}{{ entry.name|urlencode }}" class="flex items-center space-x-3 group">
                        <svg class="file-icon text-blue-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"/>
                        </svg>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between">
                                <span class="text-black dark:text-white font-medium group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors truncate">{{ entry.name }}/</span>
                                <div class="flex items-center space-x-4 text-sm text-gray-700 dark:text-gray-300">
                                    <span class="badge bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">Directory</span>
                                    {% if entry.modified != "" %}
                                    <span>{{ entry.modified }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
                            <path d="m9 18 6-6-6-6"/>
                        </svg>
                    </a>
                </div>
                {% endfor %}

                <!-- Files Section -->
                {% for entry in entries if !entry.is_dir %}
                <div class="p-4 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                    <a href="{{ current_path|urlencode }}{% if !current_path.ends_with("/") %}/{% endif %}{{ entry.name|urlencode }}" class="flex items-center space-x-3 group">
                        <!-- File type icon -->
                        {% if entry.extension == "pdf" %}
                        <svg class="file-icon text-red-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10,9 9,9 8,9"/>
                        </svg>
                        {% elif entry.extension == "jpg" %}
                        <svg class="file-icon text-green-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="18" height="18" x="3" y="3" rx="2" ry="2"/>
                            <circle cx="9" cy="9" r="2"/>
                            <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
                        </svg>
                        {% elif entry.extension == "jpeg" %}
                        <svg class="file-icon text-green-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="18" height="18" x="3" y="3" rx="2" ry="2"/>
                            <circle cx="9" cy="9" r="2"/>
                            <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
                        </svg>
                        {% elif entry.extension == "png" %}
                        <svg class="file-icon text-green-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="18" height="18" x="3" y="3" rx="2" ry="2"/>
                            <circle cx="9" cy="9" r="2"/>
                            <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
                        </svg>
                        {% elif entry.extension == "gif" %}
                        <svg class="file-icon text-green-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="18" height="18" x="3" y="3" rx="2" ry="2"/>
                            <circle cx="9" cy="9" r="2"/>
                            <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
                        </svg>
                        {% elif entry.extension == "svg" %}
                        <svg class="file-icon text-green-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="18" height="18" x="3" y="3" rx="2" ry="2"/>
                            <circle cx="9" cy="9" r="2"/>
                            <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
                        </svg>
                        {% elif entry.extension == "txt" %}
                        <svg class="file-icon text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        {% elif entry.extension == "md" %}
                        <svg class="file-icon text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        {% elif entry.extension == "rst" %}
                        <svg class="file-icon text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        {% elif entry.extension == "zip" %}
                        <svg class="file-icon text-yellow-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="16" height="13" x="6" y="4" rx="2"/>
                            <path d="m22 7-8-4-8 4"/>
                            <path d="m2 7 8 4 8-4"/>
                            <path d="m2 7v10c0 1.1.9 2 2 2h16a2 2 0 0 0 2-2V7"/>
                        </svg>
                        {% elif entry.extension == "tar" %}
                        <svg class="file-icon text-yellow-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="16" height="13" x="6" y="4" rx="2"/>
                            <path d="m22 7-8-4-8 4"/>
                            <path d="m2 7 8 4 8-4"/>
                            <path d="m2 7v10c0 1.1.9 2 2 2h16a2 2 0 0 0 2-2V7"/>
                        </svg>
                        {% elif entry.extension == "gz" %}
                        <svg class="file-icon text-yellow-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="16" height="13" x="6" y="4" rx="2"/>
                            <path d="m22 7-8-4-8 4"/>
                            <path d="m2 7 8 4 8-4"/>
                            <path d="m2 7v10c0 1.1.9 2 2 2h16a2 2 0 0 0 2-2V7"/>
                        </svg>
                        {% elif entry.extension == "rar" %}
                        <svg class="file-icon text-yellow-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="16" height="13" x="6" y="4" rx="2"/>
                            <path d="m22 7-8-4-8 4"/>
                            <path d="m2 7 8 4 8-4"/>
                            <path d="m2 7v10c0 1.1.9 2 2 2h16a2 2 0 0 0 2-2V7"/>
                        </svg>
                        {% elif entry.extension == "rs" %}
                        <svg class="file-icon text-purple-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="9" y1="15" x2="15" y2="15"/>
                            <line x1="12" y1="13" x2="12" y2="17"/>
                        </svg>
                        {% elif entry.extension == "js" %}
                        <svg class="file-icon text-purple-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="9" y1="15" x2="15" y2="15"/>
                            <line x1="12" y1="13" x2="12" y2="17"/>
                        </svg>
                        {% elif entry.extension == "ts" %}
                        <svg class="file-icon text-purple-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="9" y1="15" x2="15" y2="15"/>
                            <line x1="12" y1="13" x2="12" y2="17"/>
                        </svg>
                        {% elif entry.extension == "py" %}
                        <svg class="file-icon text-purple-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="9" y1="15" x2="15" y2="15"/>
                            <line x1="12" y1="13" x2="12" y2="17"/>
                        </svg>
                        {% elif entry.extension == "go" %}
                        <svg class="file-icon text-purple-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="9" y1="15" x2="15" y2="15"/>
                            <line x1="12" y1="13" x2="12" y2="17"/>
                        </svg>
                        {% elif entry.extension == "java" %}
                        <svg class="file-icon text-purple-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="9" y1="15" x2="15" y2="15"/>
                            <line x1="12" y1="13" x2="12" y2="17"/>
                        </svg>
                        {% else %}
                        <svg class="file-icon text-muted-foreground" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                        </svg>
                        {% endif %}
                        
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between">
                                <span class="text-black dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors truncate">{{ entry.name }}</span>
                                <div class="flex items-center space-x-4 text-sm text-black dark:text-gray-400">
                                    {% if entry.extension != "" %}
                                    <span class="badge bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">{{ entry.extension|upper }}</span>
                                    {% endif %}
                                    {% if entry.size != "" %}
                                    <span>{{ entry.size }}</span>
                                    {% endif %}
                                    {% if entry.modified != "" %}
                                    <span>{{ entry.modified }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
                            <path d="m9 18 6-6-6-6"/>
                        </svg>
                    </a>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="p-8 text-center">
                <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"/>
                </svg>
                <h3 class="text-lg font-medium text-black dark:text-white mb-2">Empty Directory</h3>
                <p class="text-black dark:text-gray-400">This directory contains no files or subdirectories.</p>
            </div>
            {% endif %}
        </div>

        <!-- Footer -->
        <footer class="mt-8 pt-4 border-t border-gray-200 dark:border-gray-700 text-center text-sm text-black dark:text-gray-400">
            <p>Powered by <strong><a href="https://github.com/Akagi201/serve-rs" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline">serve-rs</a></strong> - A minimal static file server</p>
        </footer>
    </div>

    <!-- Tailwind CSS JavaScript (not needed as we're using the CDN version) -->
    
    <!-- Theme toggle script -->
    <script>
        // Global theme management
        (function() {
            function getThemePreference() {
                const storedTheme = localStorage.getItem('theme');
                if (storedTheme) {
                    return storedTheme; // 'light' or 'dark'
                }
                
                // If no stored preference, use system preference
                return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }

            function applyTheme(theme) {
                const html = document.documentElement;
                const sunIcon = document.getElementById('sun-icon');
                const moonIcon = document.getElementById('moon-icon');
                
                console.log('Applying theme:', theme); // Debug
                
                if (theme === 'dark') {
                    html.classList.add('dark');
                    if (sunIcon) sunIcon.classList.add('hidden');
                    if (moonIcon) moonIcon.classList.remove('hidden');
                } else {
                    html.classList.remove('dark');
                    if (sunIcon) sunIcon.classList.remove('hidden');
                    if (moonIcon) moonIcon.classList.add('hidden');
                }
            }

            // Theme toggle functionality - expose globally
            window.toggleTheme = function() {
                const currentTheme = getThemePreference();
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                console.log('Toggling from', currentTheme, 'to', newTheme); // Debug
                
                localStorage.setItem('theme', newTheme);
                applyTheme(newTheme);
            };

            // Initialize theme from localStorage or system preference
            function initTheme() {
                const theme = getThemePreference();
                console.log('Initializing theme:', theme); // Debug
                applyTheme(theme);
            }

            // Listen for system theme changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
                // Only auto-update if user hasn't set an explicit preference
                if (!localStorage.getItem('theme')) {
                    const newTheme = e.matches ? 'dark' : 'light';
                    console.log('System theme changed to:', newTheme); // Debug
                    applyTheme(newTheme);
                }
            });

            // Initialize immediately if possible
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initTheme);
            } else {
                initTheme();
            }
            
            // Also initialize when DOM is ready (redundant but safe)
            document.addEventListener('DOMContentLoaded', initTheme);
        })();
    </script>
</body>
</html>